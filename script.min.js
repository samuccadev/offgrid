"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>console.log("ServiceWorker registrado com sucesso: ",e.scope)).catch(e=>console.log("Falha ao registrar ServiceWorker: ",e))});let appliances=[],currentListName="Nova Lista",welcomeScreen=document.getElementById("welcomeScreen"),appContent=document.getElementById("appContent"),savedListsContainer=document.getElementById("savedListsContainer"),savedLists=document.getElementById("savedLists"),batteryUnitCapacity=parseFloat(document.getElementById("batteryUnitCapacity").value),systemLosses=parseFloat(document.getElementById("systemLosses").value)/100,appliancesList=document.getElementById("appliancesList"),appliancesCardsList=document.getElementById("appliancesCardsList"),totalConsumptionSpan=document.getElementById("totalConsumption"),totalConsumptionConfig=document.getElementById("totalConsumptionConfig"),totalConsumptionResults=document.getElementById("totalConsumptionResults");function showWelcomeScreen(){welcomeScreen.style.display="flex",appContent.style.display="none",savedListsContainer.style.display="none"}function updateSystemResults(){if(0!==appliances.length){let n=parseInt(document.getElementById("autonomy").value),a=parseInt(document.getElementById("systemVoltage").value);var e=parseInt(document.getElementById("batteryEfficiency").value);let s=parseInt(document.getElementById("dischargeDepth").value),l=parseFloat(document.getElementById("sunHours").value),o=parseFloat(document.getElementById("panelPower").value);var t=document.getElementById("batteryType").value,i=parseInt(document.getElementById("batteryUnitCapacity").value),d=parseFloat(document.getElementById("systemLosses").value)/100,t="leadAcid"===t?"Chumbo Ácido":"LiFePO4",c=appliances.reduce((e,t)=>e+t.dailyConsumption,0),e=c*n/(a*(s/100)*(e/100)*(1-d)),d=Math.ceil(e/i),m=c/.8,r=Math.ceil(m/o),u=m/a,c=(document.getElementById("totalDailyConsumption").textContent=c.toFixed(2)+" Wh/dia",document.getElementById("geracaoNecessaria").textContent=m.toFixed(2)+" Wh/dia",document.getElementById("solarPanels").textContent=r+" unidades",document.getElementById("chargeController").textContent=u.toFixed(2)+" A",document.getElementById("batteryCapacity").textContent=e.toFixed(2)+" Ah",document.getElementById("batteryTypeResult").textContent=t,document.getElementById("quantidadeBaterias").textContent=d+" unidades",["autonomyDays","dischargePercent","sunHoursValue","panelPowerValue","tensaoSistema"].forEach(e=>{var t=document.getElementById(e);t&&(t.textContent={autonomyDays:n,dischargePercent:s,sunHoursValue:l,panelPowerValue:o,tensaoSistema:a}[e])}),document.getElementById("batteryUnitCapacityText"));c&&(c.textContent=i)}}function updateAppliancesList(){appliancesList.innerHTML="",appliancesCardsList.innerHTML="";let o=0;0===appliances.length?(e=`
                <tr><td colspan="6" class="text-center py-4">
                    <i class="fas fa-inbox fs-2"></i>
                    <p class="mt-2 mb-0">Nenhum aparelho adicionado</p>
                </td></tr>`,appliancesList.innerHTML=e,appliancesCardsList.innerHTML=e):appliances.forEach((e,t)=>{o+=e.dailyConsumption;var n=document.createElement("tr"),a=(n.innerHTML=`
                    <td>${e.name}</td>
                    <td>${e.quantity}</td>
                    <td>${e.power} W</td>
                    <td>${e.hours} h</td>
                    <td>${e.dailyConsumption.toFixed(2)} Wh</td>
                    <td>
                        <div class="d-flex gap-1"></div>
                    </td>`,n.querySelector("td:last-child div")),s=document.createElement("button"),l=(s.className="btn btn-sm btn-warning",s.innerHTML='<i class="fas fa-edit"></i>',s.addEventListener("click",()=>editAppliance(t)),document.createElement("button")),s=(l.className="btn btn-sm btn-danger",l.innerHTML='<i class="fas fa-trash"></i>',l.addEventListener("click",()=>removerAparelho(t)),a.appendChild(s),a.appendChild(l),appliancesList.appendChild(n),document.createElement("div")),a=(s.className="card mb-3 p-3",s.innerHTML=`
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">${e.name}</h6>
                        <span class="badge bg-primary">${e.quantity}x</span>
                    </div>
                    <div>Potência: ${e.power} W</div>
                    <div>Horas/dia: ${e.hours} h</div>
                    <div>Consumo: <strong>${e.dailyConsumption.toFixed(2)} Wh/dia</strong></div>
                    <div class="d-flex gap-2 mt-2"></div>`,s.querySelector(".d-flex.gap-2")),l=document.createElement("button"),n=(l.className="btn btn-sm btn-warning w-50",l.innerHTML='<i class="fas fa-edit me-1"></i> Editar',l.addEventListener("click",()=>editAppliance(t)),document.createElement("button"));n.className="btn btn-sm btn-danger w-50",n.innerHTML='<i class="fas fa-trash me-1"></i> Remover',n.addEventListener("click",()=>removerAparelho(t)),a.appendChild(l),a.appendChild(n),appliancesCardsList.appendChild(s)});var e=o.toFixed(2)+" Wh/dia";totalConsumptionSpan.textContent=e,totalConsumptionConfig.textContent=e,totalConsumptionResults.textContent=e,document.getElementById("totalKwh").textContent=o.toFixed(2),document.getElementById("totalKwhMobile").textContent=e,document.getElementById("totalAparelhos").textContent=appliances.length,document.getElementById("totalAparelhosMobile").textContent=appliances.length,updateSystemResults()}function startNewCalculation(){appliances=[],currentListName="Nova Lista",salvarListaAtual()}function showSavedLists(){savedListsContainer.style.display="block",renderSavedLists()}function hideSavedLists(){savedListsContainer.style.display="none"}function renderSavedLists(){savedLists.innerHTML="";let s=!1;Object.keys(localStorage).forEach(n=>{if(n.startsWith("solarList_")){s=!0;let t=n.replace("solarList_",""),e=JSON.parse(localStorage.getItem(n));var a=document.createElement("div");a.className="saved-list-item p-3 border rounded mb-2 d-flex justify-content-between align-items-center",a.innerHTML=`
                <div class="me-2">
                    <h5 class="mb-1">${t}</h5>
                    <p class="mb-1">${e.appliances.length} aparelhos</p>
                    <small>Consumo: ${calculateTotalConsumption(e.appliances).toFixed(2)} Wh/dia</small>
                </div>
                <button class="btn btn-sm btn-danger delete-list">
                    <i class="fas fa-trash"></i>
                </button>
            `,a.addEventListener("click",()=>loadSavedList(t,e)),a.querySelector(".delete-list").addEventListener("click",e=>{e.stopPropagation(),confirm(`Deseja excluir a lista "${t}"?`)&&(localStorage.removeItem(n),renderSavedLists())}),savedLists.appendChild(a)}}),s||(savedLists.innerHTML=`
            <div class="text-center py-4">
                <i class="fas fa-inbox fs-2"></i>
                <p class="mt-2 mb-0">Nenhuma lista salva</p>
            </div>
        `)}function calculateTotalConsumption(e){return e.reduce((e,t)=>e+t.dailyConsumption,0)}function loadSavedList(e,t){appliances=t.appliances,currentListName=e,t.config&&(Object.entries(t.config).forEach(([e,t])=>{e=document.getElementById(e);e&&(e.value=t)}),document.getElementById("batteryType").dispatchEvent(new Event("change")));e=document.getElementById("batteryUnitCapacityText");e&&t.config.batteryUnitCapacity&&(e.textContent=t.config.batteryUnitCapacity),welcomeScreen.style.display="none",appContent.style.display="block",updateAppliancesList(),toggleResultsSection(),0<appliances.length&&document.getElementById("calculateBtn").click()}function showTab(e){document.querySelectorAll(".tab-pane").forEach(e=>e.classList.remove("show","active")),document.getElementById(e).classList.add("show","active"),window.scrollTo(0,0)}document.addEventListener("DOMContentLoaded",()=>{showWelcomeScreen();let o=document.getElementById("applianceForm");var e=document.getElementById("calculateBtn");document.getElementById("resultsSection"),document.getElementById("emptyState");let t=document.getElementById("batteryType"),n=document.getElementById("dischargeDepth"),a=document.getElementById("batteryEfficiency"),i=document.getElementById("editIndex"),s={leadAcid:{dischargeDepth:50,efficiency:85},lifepo4:{dischargeDepth:80,efficiency:95}};function p(){var e={appliances:appliances,config:{autonomy:document.getElementById("autonomy").value,systemVoltage:document.getElementById("systemVoltage").value,batteryType:document.getElementById("batteryType").value,dischargeDepth:document.getElementById("dischargeDepth").value,batteryEfficiency:document.getElementById("batteryEfficiency").value,sunHours:document.getElementById("sunHours").value,panelPower:document.getElementById("panelPower").value,batteryUnitCapacity:document.getElementById("batteryUnitCapacity").value,systemLosses:document.getElementById("systemLosses").value}};localStorage.setItem("solarList_"+currentListName,JSON.stringify(e))}t.addEventListener("change",()=>{var e=s[t.value];n.value=e.dischargeDepth,a.value=e.efficiency}),o.addEventListener("submit",e=>{e.preventDefault();var t,e=document.getElementById("applianceName").value,n=parseInt(document.getElementById("quantity").value),a=parseFloat(document.getElementById("power").value),s=parseFloat(document.getElementById("hours").value),l=parseInt(i.value);e&&n&&a&&s&&(t=n*a*s,-1===l?appliances.push({name:e,quantity:n,power:a,hours:s,dailyConsumption:t}):(appliances[l]={name:e,quantity:n,power:a,hours:s,dailyConsumption:t},l=document.getElementById("submitButton"),i.value="-1",l.innerHTML='<i class="fas fa-plus me-1"></i> Adicionar',o.reset(),document.getElementById("quantity").value=1),updateAppliancesList(),o.reset(),document.getElementById("quantity").value=1,toggleResultsSection())}),window.toggleResultsSection=()=>{var e=document.getElementById("resultsSection"),t=document.getElementById("emptyState");0===appliances.length?(e&&(e.style.display="none"),t&&(t.style.display="block")):(e&&(e.style.display="block"),t&&(t.style.display="none")),console.log("chanmou"),p()},window.editAppliance=e=>{var t=document.getElementById("submitButton"),n=document.getElementById("editIndex"),a=document.getElementById("applianceForm");let s=appliances[e];["applianceName","quantity","power","hours"].forEach(function(e){document.getElementById(e).value=s["applianceName"===e?"name":e]}),n.value=e,t.innerHTML='<i class="fas fa-save me-1"></i> Atualizar',a.scrollIntoView({behavior:"smooth"}),window.innerWidth<=768&&showTab("appliances")},window.removerAparelho=e=>{confirm("Tem certeza que deseja remover este aparelho?")&&(appliances.splice(e,1),updateAppliancesList(),p(),toggleResultsSection())},e.addEventListener("click",()=>{if(0===appliances.length)return alert("Adicione pelo menos um aparelho para calcular o sistema.");let n=parseInt(document.getElementById("autonomy").value),a=parseInt(document.getElementById("systemVoltage").value);var e=parseInt(document.getElementById("batteryEfficiency").value);let s=parseInt(document.getElementById("dischargeDepth").value),l=parseFloat(document.getElementById("sunHours").value),o=parseFloat(document.getElementById("panelPower").value);var t=document.getElementById("batteryType").value,i=parseInt(document.getElementById("batteryUnitCapacity").value),d=parseFloat(document.getElementById("systemLosses").value)/100,t="leadAcid"===t?"Chumbo Ácido":"LiFePO4",c=appliances.reduce((e,t)=>e+t.dailyConsumption,0),e=c*n/(a*(s/100)*(e/100)*(1-d)),d=Math.ceil(e/i),m=c/.8,r=Math.ceil(m/o),u=m/a,c=(document.getElementById("totalDailyConsumption").textContent=c.toFixed(2)+" Wh/dia",document.getElementById("geracaoNecessaria").textContent=m.toFixed(2)+" Wh/dia",document.getElementById("solarPanels").textContent=r+" unidades",document.getElementById("chargeController").textContent=u.toFixed(2)+" A",document.getElementById("batteryCapacity").textContent=e.toFixed(2)+" Ah",document.getElementById("batteryTypeResult").textContent=t,document.getElementById("quantidadeBaterias").textContent=d+" unidades",["autonomyDays","dischargePercent","sunHoursValue","panelPowerValue","tensaoSistema"].forEach(e=>{var t=document.getElementById(e);t&&(t.textContent={autonomyDays:n,dischargePercent:s,sunHoursValue:l,panelPowerValue:o,tensaoSistema:a}[e])}),window.innerWidth<=768&&showTab("results"),document.getElementById("batteryUnitCapacityText"));c&&(c.textContent=i),p()}),window.salvarListaAtual=()=>{var e,t=prompt("Digite um nome para a lista:",currentListName);t&&(e={appliances:appliances,config:{autonomy:document.getElementById("autonomy").value,systemVoltage:document.getElementById("systemVoltage").value,batteryType:document.getElementById("batteryType").value,dischargeDepth:document.getElementById("dischargeDepth").value,batteryEfficiency:document.getElementById("batteryEfficiency").value,sunHours:document.getElementById("sunHours").value,panelPower:document.getElementById("panelPower").value,batteryUnitCapacity:document.getElementById("batteryUnitCapacity").value,systemLosses:document.getElementById("systemLosses").value}},localStorage.setItem("solarList_"+t,JSON.stringify(e)),currentListName=t,welcomeScreen.style.display="none",appContent.style.display="block",updateAppliancesList(),toggleResultsSection())},updateAppliancesList(),toggleResultsSection()});